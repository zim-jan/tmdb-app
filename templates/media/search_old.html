{% extends "base.html" %}

{% block title %}Search Media{% endblock %}

{% block content %}
<div class="hero">
    <div class="container">
        <h1>Search TMDb</h1>
        <p>Find movies and TV shows</p>
    </div>
</div>

<div class="container" style="margin-top: 3rem;">
    <form method="get" style="max-width: 800px; margin: 0 auto 3rem;">
        <div style="display: flex; gap: 1rem;">
            <input 
                type="text" 
                name="q" 
                class="form-control" 
                placeholder="Search for movies and TV shows..." 
                value="{{ query }}"
                style="flex: 1;"
            >
            <select name="type" class="form-control" style="width: 150px;">
                <option value="">All Types</option>
                <option value="movie" {% if media_type == "movie" %}selected{% endif %}>Movies</option>
                <option value="tv" {% if media_type == "tv" %}selected{% endif %}>TV Shows</option>
            </select>
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </form>

    {% if query %}
        {% if results %}
            <h2 style="margin-bottom: 2rem;">Results for "{{ query }}"</h2>
            <div class="grid">
                {% for result in results %}
                    <div class="card">
                        <div class="card-body">
                            <h3>{{ result.title }}</h3>
                            <p style="color: var(--text-muted); margin: 0.5rem 0;">
                                {{ result.media_type|upper }}
                                {% if result.release_date %}
                                    • {{ result.release_date }}
                                {% elif result.first_air_date %}
                                    • {{ result.first_air_date }}
                                {% endif %}
                            </p>
                            {% if result.overview %}
                                <p style="font-size: 0.9rem; color: var(--text-muted); margin: 1rem 0;">
                                    {{ result.overview|truncatewords:20 }}
                                </p>
                            {% endif %}
                            
                            <form method="post" action="{% url 'media:add_to_list' %}" style="margin-top: 1rem;">
                                {% csrf_token %}
                                <input type="hidden" name="tmdb_id" value="{{ result.id }}">
                                <input type="hidden" name="media_type" value="{{ result.media_type }}">
                                <div style="display: flex; gap: 0.5rem;">
                                    <select name="list_id" class="form-control" required>
                                        <option value="">Select a list...</option>
                                        {% for list in request.user.list_set.all %}
                                            <option value="{{ list.id }}">{{ list.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <button type="submit" class="btn btn-primary">Add</button>
                                </div>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 3rem; background: var(--bg-secondary); border-radius: 8px;">
                <p style="color: var(--text-muted);">No results found for "{{ query }}"</p>
            </div>
        {% endif %}
    {% else %}
        <div style="text-align: center; padding: 3rem; background: var(--bg-secondary); border-radius: 8px;">
            <p style="color: var(--text-muted);">Enter a search query to find movies and TV shows</p>
        </div>
    {% endif %}
</div>
{% endblock %}
